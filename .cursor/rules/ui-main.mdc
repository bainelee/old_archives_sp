---
description: 主 UI (TopBar) 布局、可复用组件、数据与视觉规范
globs:
  - "scripts/ui/**"
  - "scenes/ui/**"
  - "docs/design/0[4-6]*.md"
alwaysApply: false
---

# 主 UI 规范

开发/修改 `scripts/ui/`、`scenes/ui/` 及时间/侵蚀相关设计文档时须遵守以下约定。

## 布局结构

- **主场景**：`scenes/ui/ui_main.tscn`，CanvasLayer layer=10
- **TopBar**：48px 高，全宽；顺序：因子|货币 | Spacer | **TimePanel** | Spacer | 人员 | **ShelterErosionPanel**
- **居中**：TimePanel 两侧用 Control + `size_flags_horizontal = 3` 实现居中
- **分区间距**：HBox 32px；子区 12px；因子/人员项 4px

## 可复用组件

| 组件 | 场景 | 数据源 |
|------|------|--------|
| TimePanel | time_panel.tscn | GameTime |
| ShelterErosionPanel | shelter_erosion_panel.tscn | ErosionCore |

- TimePanel：播放/暂停、1x/2x/6x/96x、时间文本；TimeIndicator 绕中心旋转
- ShelterErosionPanel：左侧侵蚀等级，右侧 ErosionCycleBar；悬停显示来源/周期详情
- 侵蚀颜色：+1 白、0 翠绿、-2 橙黄、-4 赤红、-8 深紫（erosion_cycle_bar.gd 常量）

## 视觉约定

- TopBar 背景：`Color(0.12, 0.12, 0.18, 0.92)`，下角圆角 4
- 标签：Name `(0.7,0.75,0.85)`，Value `(0.95,0.9,0.7)` 14px
- 悬停弹出层：reparent 至 CanvasLayer 顶层（z_index=100），0.15s 延迟隐藏，位置限制在视口内

## UIMain 数据

- 通过属性或 `set_resources(factors, currency, personnel)` 注入
- 因子：cognition, computation, willpower, permission
- 货币：info, truth
- 人员：researcher（显示为 未侵蚀/总数，如 8/10；eroded 供 PersonnelErosionCore 使用）, investigator

## 参考

- 设计文档：`docs/design/04-time-system.md`、`05-shelter-erosion-ui.md`、`06-ui-main-overview.md`

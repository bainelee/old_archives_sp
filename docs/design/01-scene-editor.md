# 01 - 场景编辑器设计文档

## 概述

《旧日档案馆》是一款 2D 视角的基地建设、模拟经营、资源管理游戏，视角与《缺氧》《司辰之书》类似。场景编辑器是游戏最基础的功能模块，用于在引擎中编辑档案馆的室内场景。

---

## 网格系统

- **地图尺寸**：80 × 40 个网格单位
- **坐标系**：以网格为单位进行定位与编辑
- **用途**：所有场景元素的放置、房间划分均基于网格

---

## 一级编辑：底板铺设

在网格中填充底板（Tile），作为场景的基础层。

### 底板类型

| 类型 | 说明 | 交互 |
|------|------|------|
| 墙壁/装饰 | 墙体、装饰物等 | 无交互 |
| 房间底板 | 可供建设房间的地面 | 用于排布基础房间 |

### 编辑功能

- 在网格上绘制/铺设底板
- 切换不同底板类型进行填充
- 支持擦除、替换

---

## 二级编辑：房间区域划分

在一级铺设的底板上，进一步划分功能区域。

### 功能说明

- 在已铺设的**房间底板**上，划出区域
- 为每个区域指定对应的**房间类型**
- 区域与名词解释中的基础房间（如图书室、实验室、宿舍等）对应

### 编辑流程

1. 选择区域绘制工具
2. 在房间底板上框选或绘制区域范围
3. 为区域绑定房间类型（如：哲学文献室、档案馆门卫室等）
4. 区域数据持久化，供后续游戏逻辑使用

---

## 实现层级关系

```
场景
├── 网格层 (80×40)
├── 底板层 (墙壁/装饰 | 房间底板)
└── 区域层 (在房间底板上的房间划分)
```

---

## 已实现

- [x] 网格系统：80×40，每格 20px
- [x] 底板编辑：空 / 墙壁 / 房间底板 三种类型
- [x] 场景保存/加载：JSON 格式，保存至 `user://scene_archive.json`
- [x] 操作：左键绘制、中键拖拽平移、滚轮缩放
- [x] 单选：点击单格操作（创造或橡皮擦均为单格）
- [x] 框选：拖拽框选范围，释放后批量应用当前工具
- [x] 工具：空 / 墙壁 / 房间底板 / 橡皮擦
- [x] 标尺网格：左侧与顶部显示网格坐标刻度
- [x] 网格对齐开关：开启后镜头移动吸附至网格

## 待定事项

- 底板与 room type 的关联规则
- 区域多选、复制、粘贴
- 删除房间功能

## 已实现 - 二级编辑

- [x] 编辑层级切换：底板 / 房间
- [x] 房间框选创建：在房间底板上框选创建房间
- [x] 房间点击选择：单选模式下点击房间进行选择
- [x] 房间信息编辑：名称、类型、资源类型、资源总量
- [x] RoomInfo 结构体：id、room_name、rect(size)、room_type、resource_type、resource_total
- [x] 房间数据保存/加载

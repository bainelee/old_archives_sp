# 07 - 研究员侵蚀机制

## 概述

本文档描述《旧日档案馆》中研究员被神秘侵蚀的完整机制，包括侵蚀风险累积、侵蚀判定、被侵蚀状态、灾厄值贡献、死亡与治愈。术语中英对照见 [00-project-keywords](../../settings/00-project-keywords.md)。

---

## 1. 侵蚀风险累积

### 1.1 每日侵蚀判定

当研究员所在工作场所的**庇护等级**为**薄弱**、**暴露**或**绝境**时，该研究员每天会进行一次侵蚀概率判定。

| 庇护等级 | 庇护等级数值 | 每日侵蚀判定概率 |
|----------|-------------|-----------------|
| 绝境 | ≤ -5 | 80% |
| 暴露 | -4 ~ -2 | 50% |
| 薄弱 | -1 ~ 1 | 20% |
| 妥善 | 2 ~ 4 | 0%（无判定） |
| 完美 | ≥ 5 | 0%（无判定） |

### 1.2 判定逻辑

- **时机**：每天结束时（游戏内 24 小时周期结束）
- **对象**：每个处于薄弱/暴露/绝境庇护下的研究员
- **过程**：随机 1～100，若随机数 ≤ 当前侵蚀概率，则为该研究员附加一个 **侵蚀风险** 标记
- **示例**：随机出 12，当前侵蚀概率 20%，则 12 ≤ 20，此研究员获得 1 个侵蚀风险标记

### 1.3 侵蚀风险结算

- **时机**：每 **7 天** 结束时
- **条件**：若某研究员的侵蚀风险标记数量 **超过 5 个**（即 ≥ 6 个），则该研究员被侵蚀
- **结果**：研究员变为**被侵蚀状态**，同时清除该研究员的所有侵蚀风险标记
- **说明**：7 天内最多积累 7 个标记，需在多数天数被「命中」才触发侵蚀，体现庇护不足的累积效应

---

## 2. 被侵蚀状态

### 2.1 行为变化

被侵蚀的研究员**不再**在其原本工作的房间工作，而是**返回生活区宿舍**休息。

- 被侵蚀的研究员不参与生产、建设、清理等劳动
- 占用住房（宿舍/生活区提供的住房）
- 仍计入研究员总人数，但作为「被侵蚀」子集（`personnel.eroded`）

### 2.2 灾厄值贡献

每个被侵蚀的研究员 **每小时** 增加 **1 点** 灾厄值。

```
每小时灾厄值增量 = 被侵蚀的研究员人数 × 1
```

灾厄值用于影响最终危机与游戏失败，详见灾厄值相关设计文档。

---

## 3. 死亡机制

### 3.1 死亡概率曲线

被侵蚀时间过长的研究员会逐渐面临死亡风险。死亡概率随被侵蚀天数增长，曲线类似指数函数：

| 被侵蚀天数 | 约对应周数 | 死亡概率 |
|------------|-----------|----------|
| 0 | 第 0 周 | 0% |
| 112 | 第 16 周 | 50% |
| 140 | 第 20 周 | 100% |

- **曲线形态**：类指数增长，前期增长较缓，后期急剧上升
- **实现建议**：可用 `P(day) = 1 - exp(-k × day)` 或分段插值，使第 16 周约 50%、第 20 周约 100%

### 3.2 死亡判定

- **时机**：每天结束时
- **对象**：每个处于被侵蚀状态的研究员
- **过程**：根据该研究员被侵蚀的天数，计算当日死亡概率；随机判定，若命中则研究员死亡
- **结果**：死亡的研究员**彻底消失**，研究员总人数减少（`personnel.researcher` 减 1，`personnel.eroded` 相应减少）

---

## 4. 治愈机制

### 4.1 治愈条件

研究员所在**生活区宿舍**的庇护等级为 **妥善** 或 **完美** 时，有机会被治愈。

- 生活区宿舍的庇护等级由该宿舍房间是否处于档案馆核心庇护范围内、以及核心出力等级决定
- 若宿舍在庇护范围外，则不满足治愈条件

### 4.2 治愈判定

- **周期**：每 **3 天** 进行一次治愈判定
- **概率**：根据生活区宿舍的庇护等级

| 宿舍庇护等级 | 治愈概率 |
|-------------|----------|
| 妥善（2 ~ 4） | 30% |
| 完美（≥ 5） | 80% |

- **过程**：随机判定，若成功则研究员被治愈，脱离被侵蚀状态

### 4.3 治愈后行为

- **返回工作岗位**：被治愈的研究员可返回**之前的工作场所**（被侵蚀前所在的房间）
- **侵蚀免疫**：治愈后 **1 周内**（7 天）不会被神秘侵蚀，即使庇护状态为绝境
- **免疫结束后**：恢复正常侵蚀判定逻辑

---

## 5. 认知消耗与认知危机

### 5.1 研究员个体

每个研究员为**独立个体**，拥有唯一 `id`。侵蚀风险、认知危机等状态均按个体维护。消耗认知时按 `id` 顺序依次处理。

### 5.2 每日认知消耗

- **时机**：每天结束时
- **每人消耗**：24 认知
- **顺序**：按研究员编号（id）从小到大依次消耗
- **过程**：若认知储备足够，则该研究员消耗 24 认知，并消除 1 个「认知危机」标记（若有）；若不足，则该研究员获得 1 个「认知危机」标记

### 5.3 认知危机

- **标记上限**：3 个
- **达到上限**：研究员进入**认知失能**状态
- **认知失能**：每天增加 10 点灾厄值
- **恢复**：每次成功消耗认知可消除 1 个标记；当 3 个标记全部消除，脱离认知失能，不再增加灾厄值

---

## 6. 流程时序汇总

```
每天结束：
  0. 按 id 顺序消耗认知（每人 24）；不足则 +1 认知危机，成功则 -1 认知危机
  0b. 认知失能研究员（认知危机 ≥3）每人 +10 灾厄/天
  1. 对处于薄弱/暴露/绝境下的研究员进行侵蚀判定 → 可能获得侵蚀风险标记
  2. 对已侵蚀研究员进行死亡判定 → 可能死亡并移除
  3. 若为第 7 天倍数：结算侵蚀风险，超过 5 个标记的研究员 → 变为被侵蚀状态

每 3 天（对被侵蚀且宿舍为妥善/完美的研究员）：
  4. 治愈判定 → 可能治愈并返回工作岗位
```

---

## 7. 数据需求（待实现时补充）

以下数据需在研究员个体或全局层面维护，供实现参考：

| 数据项 | 说明 |
|--------|------|
| id | 研究员唯一编号，用于排序消耗认知 |
| 侵蚀风险标记数 | 每个研究员的当前侵蚀风险数量，每 7 天结算时清零（若未侵蚀）或随侵蚀触发清零 |
| 认知危机标记数 | 0～3，达到 3 则认知失能 |
| 被侵蚀天数 | 用于死亡概率计算 |
| 原工作房间 | 治愈后返回的目标 |
| 治愈免疫剩余天数 | 治愈后 7 天内免疫侵蚀 |
| 宿舍庇护等级 | 由房间位置与核心范围计算得出 |

---

## 8. 相关文档

- [01 - 游戏数值系统](../0-values/01-game-values.md)：庇护等级、认知消耗
- [名词解释：侵蚀与莱卡昂](../../名词解释.md#侵蚀与莱卡昂)
- [名词解释：档案馆核心与庇护](../../名词解释.md#档案馆核心与庇护)
